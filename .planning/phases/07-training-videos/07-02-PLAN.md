---
phase: 07-training-videos
plan: 02
type: execute
---

<objective>
Add Microsoft Clarity analytics tracking and optimize video page for performance

Purpose: Enable user behavior insights with Clarity analytics and ensure training page maintains fast loading on rural connections.
Output: Clarity tracking integrated across site, training page optimized for performance with lazy loading and efficient resource management.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-training-videos/07-01-SUMMARY.md
@src/app/layout.tsx
@src/app/training/page.tsx

**Tech stack available:**
- Next.js 15.1.4 with App Router
- TypeScript for type safety
- Script component from next/script for optimized script loading

**Clarity tracking requirement:**
```javascript
<script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "vctdn13vdm");
</script>
```

**Performance considerations for rural connectivity:**
- Lazy load third-party scripts (Clarity should use afterInteractive strategy)
- Minimize initial page load time
- Defer non-critical resources
- Use Next.js Script component for optimal loading

**Established patterns:**
- Root layout (src/app/layout.tsx) contains site-wide elements
- Metadata configuration in layout for global settings
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate Microsoft Clarity analytics tracking</name>
  <files>src/app/layout.tsx</files>
  <action>Add Microsoft Clarity tracking script to root layout using Next.js Script component. Import Script from 'next/script'. Add Script component in body (after children) with strategy="afterInteractive" to avoid blocking page load. Use inline script with Clarity code: (function(c,l,a,r,i,t,y){c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);})(window, document, "clarity", "script", "vctdn13vdm"); This ensures Clarity loads after page is interactive, not blocking initial render. Add in root layout so it tracks all pages site-wide.</action>
  <verify>npm run build succeeds, Clarity script appears in page source with strategy="afterInteractive", script loads in browser DevTools Network tab</verify>
  <done>Clarity tracking script integrated in root layout, loads after page interactive, builds successfully without errors</done>
</task>

<task type="auto">
  <name>Task 2: Optimize training page video loading for performance</name>
  <files>src/app/training/page.tsx</files>
  <action>If videos are iframes (YouTube/Vimeo): ensure loading="lazy" attribute is present on all iframe elements. If videos are HTML5 video tags: add preload="none" to prevent auto-loading. Add intersection observer pattern or use native loading="lazy" to defer video loads until user scrolls to them. For YouTube embeds specifically, ensure iframe has allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" and allowFullScreen attributes for functionality. Verify aspect-video wrapper maintains 16:9 ratio on all screen sizes. If no videos yet (just placeholders), document the optimization pattern in code comments for when videos are added.</action>
  <verify>Videos (if present) load lazily, npm run build succeeds, DevTools Network shows videos don't load until viewport, page Lighthouse performance score acceptable</verify>
  <done>Video loading optimized with lazy load pattern, performance maintained for rural connections, no blocking resources on initial page load</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] npm run build succeeds without errors
- [ ] Clarity script loads in browser (check DevTools → Network → clarity.ms)
- [ ] Clarity script uses afterInteractive strategy (doesn't block page render)
- [ ] Training page videos load lazily (if videos present) or pattern documented (if placeholders)
- [ ] No TypeScript errors
- [ ] Page performance acceptable on throttled connection
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Clarity tracking active across all site pages
- Training page optimized for rural connection performance
- No errors or warnings introduced
- Phase 7 complete and ready for Phase 8 (Animations & Polish)
</success_criteria>

<output>
After completion, create `.planning/phases/07-training-videos/07-02-SUMMARY.md`:

# Phase 07 Plan 02: Analytics and Performance Summary

**[Substantive one-liner - what shipped]**

## Accomplishments

- Integrated Microsoft Clarity analytics tracking site-wide
- Optimized video loading with lazy load pattern
- Ensured performance on rural connections
- Completed Phase 7 training videos infrastructure

## Files Created/Modified

- `src/app/layout.tsx` - Added Clarity tracking script with afterInteractive strategy
- `src/app/training/page.tsx` - [Optimized video loading OR documented optimization pattern]

## Decisions Made

**Clarity strategy:** Used afterInteractive to load Clarity after page is interactive, avoiding any blocking of initial render or core functionality.

[Document video loading optimization approach - lazy loading, intersection observer, or pattern for future implementation]

## Issues Encountered

[Any issues or None]

## Next Phase Readiness

Phase 7 complete. Training videos page fully functional with:
- Analytics tracking via Microsoft Clarity
- [Video embeds with lazy loading OR placeholder infrastructure ready]
- Performance optimized for rural Scotland connections
- Consistent design patterns from established component library

Ready for Phase 8 (Animations & Polish).
</output>
