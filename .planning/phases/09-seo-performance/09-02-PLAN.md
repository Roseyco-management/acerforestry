---
phase: 09-seo-performance
plan: 02
type: execute
---

<objective>
Optimize images, configure Next.js performance features, and improve Core Web Vitals for fast loading on rural Scotland's slower connections.

Purpose: Ensure site loads quickly and smoothly on 3G/4G connections common in Highland regions. Critical for Forest Managers accessing site from remote field locations.
Output: Optimized Next.js config, image optimization, lazy loading patterns, and improved performance metrics.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Previous phase summaries
@.planning/phases/09-seo-performance/09-01-SUMMARY.md

# Key files for performance work
@next.config.ts
@src/app/layout.tsx
@src/components/sections/Hero.tsx
@src/components/sections/ValueProp.tsx

**Tech stack available:** Next.js 15.5.12, React 19, TypeScript, Tailwind CSS, Framer Motion
**Established patterns:** Framer Motion animations with viewport once:true for performance
**Constraining decisions:**
- Phase 01: Inter font with display:swap for faster loading
- Phase 07: Lazy loading pattern documented for videos (when URLs available)
- Phase 08: Animation performance optimized with viewport once:true

**Current state:**
- No images currently used (logo is SVG, no service photos yet)
- No next.config optimizations configured
- Analytics scripts load afterInteractive (good)
- Framer Motion animations already performance-optimized
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Next.js for production performance</name>
  <files>next.config.ts</files>
  <action>
    Update next.config.ts with performance optimizations:

    ```typescript
    import type { NextConfig } from 'next'

    const nextConfig: NextConfig = {
      // Compress responses
      compress: true,

      // Image optimization config (for future images)
      images: {
        formats: ['image/avif', 'image/webp'],
        deviceSizes: [640, 750, 828, 1080, 1200, 1920],
        imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],
        minimumCacheTTL: 60,
      },

      // Production optimizations
      poweredByHeader: false,
      reactStrictMode: true,

      // Enable experimental features for performance
      experimental: {
        optimizePackageImports: ['framer-motion'],
      },
    }

    export default nextConfig
    ```

    Key choices:
    - **compress: true** - Gzip compression for smaller payloads
    - **AVIF/WebP formats** - Modern image formats with better compression
    - **optimizePackageImports** - Tree-shake Framer Motion (only import what's used)
    - **poweredByHeader: false** - Remove unnecessary header
    - **minimumCacheTTL: 60** - Cache images for 1 hour minimum

    These settings prepare for future image additions and optimize current JavaScript bundle size.
  </action>
  <verify>Run `npm run build` - should complete successfully. Check build output for bundle sizes and optimizations. No config errors.</verify>
  <done>next.config.ts configured with compression, image optimization ready for future photos, and Framer Motion package optimization. Build passes with smaller bundle sizes.</done>
</task>

<task type="auto">
  <name>Task 2: Add performance monitoring and optimize font loading</name>
  <files>src/app/layout.tsx</files>
  <action>
    Add Web Vitals reporting to root layout for Core Web Vitals monitoring:

    Create src/app/web-vitals.tsx:
    ```typescript
    'use client'

    import { useReportWebVitals } from 'next/web-vitals'

    export function WebVitals() {
      useReportWebVitals((metric) => {
        // Send to analytics
        if (window.gtag) {
          window.gtag('event', metric.name, {
            value: Math.round(metric.name === 'CLS' ? metric.value * 1000 : metric.value),
            event_category: 'Web Vitals',
            event_label: metric.id,
            non_interaction: true,
          })
        }
      })
      return null
    }
    ```

    Import and add to layout.tsx body:
    ```typescript
    import { WebVitals } from './web-vitals'
    // ... in body, before MainLayout
    <WebVitals />
    ```

    **Font optimization already in place:**
    - Inter font uses display: 'swap' (from Phase 01)
    - Prevents font-loading blocking
    - No changes needed

    **Preconnect to external origins:** Add to layout.tsx head (via metadata):
    ```typescript
    export const metadata: Metadata = {
      // ... existing metadata
      other: {
        'preconnect': [
          'https://www.googletagmanager.com',
          'https://www.clarity.ms',
          'https://connect.facebook.net'
        ].join(',')
      }
    }
    ```

    Actually, Next.js doesn't support preconnect via metadata API. Instead, document in comment that these analytics domains could benefit from preconnect if performance issues arise. Don't add <link> tags - analytics already load afterInteractive.
  </action>
  <verify>Run `npm run build` and `npm run dev`. Check console for Web Vitals logging. Verify WebVitals component is client component. No TypeScript errors.</verify>
  <done>Web Vitals monitoring configured and sending to Google Analytics. Font loading already optimized with display:swap. Build passes.</done>
</task>

<task type="auto">
  <name>Task 3: Optimize component rendering and prepare for future images</name>
  <files>src/components/ui/Image.tsx (new), src/app/services/page.tsx, src/app/training/page.tsx</files>
  <action>
    Create reusable optimized Image wrapper component:

    src/components/ui/Image.tsx:
    ```typescript
    import NextImage, { ImageProps } from 'next/image'

    interface OptimizedImageProps extends Omit<ImageProps, 'placeholder'> {
      fallback?: string
    }

    export default function Image({ fallback, ...props }: OptimizedImageProps) {
      return (
        <NextImage
          {...props}
          placeholder="blur"
          blurDataURL={fallback || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2YzZjRmNiIvPjwvc3ZnPg=='}
          loading="lazy"
          quality={85}
        />
      )
    }
    ```

    This component is ready for future image additions with:
    - Automatic blur placeholder
    - Lazy loading
    - Optimized quality (85 is sweet spot)

    **Document image placeholders:** Update comments in services/page.tsx and training/page.tsx where placeholders exist:

    ```typescript
    {/* TODO: Replace with <Image src="/photos/tree-planting.jpg" alt="..." width={800} height={450} />
         Use OptimizedImage component from @/components/ui/Image for automatic optimization */}
    <div className="aspect-video bg-neutral-200 flex items-center justify-center">
      <p className="text-neutral-500">Tree Planting Photo</p>
    </div>
    ```

    Add these TODO comments to all 7 service placeholders and 4 training video placeholders.

    **React Suspense boundaries:** Already handled by Next.js App Router automatically. No additional Suspense needed.
  </action>
  <verify>Run `npm run build`. Verify Image component exports correctly. Check that TODO comments are present in services and training pages. No TypeScript errors.</verify>
  <done>Optimized Image wrapper component created for future use. Image placeholder locations documented with migration path. Build passes.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds with no errors
- [ ] Build output shows bundle size optimizations (Framer Motion tree-shaking)
- [ ] Web Vitals component logs metrics in dev console
- [ ] next.config.ts has compression and image optimization configured
- [ ] OptimizedImage component exists and exports correctly
- [ ] TODO comments added to image placeholder locations
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Next.js configured for production performance (compression, image formats)
- Web Vitals monitoring active and sending to GA4
- Bundle size optimized (Framer Motion tree-shaking)
- Future image optimization pattern established
- Ready for Plan 3 (mobile and slow connection testing)
</success_criteria>

<output>
After completion, create `.planning/phases/09-seo-performance/09-02-SUMMARY.md`:

# Phase 09 Plan 02: Performance Optimization Summary

**[Substantive one-liner - what shipped, not "phase complete"]**

## Accomplishments

- Configured Next.js for production performance (compression, image optimization, package tree-shaking)
- Added Web Vitals monitoring integrated with Google Analytics
- Created reusable OptimizedImage component for future image additions
- Documented migration path for replacing placeholders with optimized images
- Verified font loading already optimized (display:swap from Phase 01)

## Files Created/Modified

- `next.config.ts` - Added compression, image optimization config, Framer Motion tree-shaking
- `src/app/web-vitals.tsx` - Created Web Vitals monitoring component
- `src/app/layout.tsx` - Imported WebVitals component
- `src/components/ui/Image.tsx` - Created optimized Image wrapper component
- `src/app/services/page.tsx` - Added TODO comments for future image optimization
- `src/app/training/page.tsx` - Added TODO comments for future video/image optimization

## Decisions Made

[Document any key decisions made during implementation]

## Issues Encountered

[Document any problems and how they were resolved, or "None"]

## Next Step

Ready for 09-03-PLAN.md (Mobile and slow connection testing)
</output>
